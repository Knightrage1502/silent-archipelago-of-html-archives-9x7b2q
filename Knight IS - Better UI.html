<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Home</title>
  <link rel="icon" href="https://ssl.gstatic.com/classroom/favicon.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #101014; --panel: #18181c; --accent: #66c0f4;
      --border: #2a2a2f; --text: #e5e5e5; --muted: #aaa;
      --danger: #e74c3c;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: "Segoe UI", system-ui, sans-serif;
      background: var(--bg); color: var(--text);
      display: flex; flex-direction: column; height: 100vh;
    }

    /* TOP BAR */
    #topbar {
      background: var(--panel); border-bottom: 1px solid var(--border);
      padding: 10px 12px; display: flex; align-items: center; gap: 12px;
    }
    #urlInput {
      flex: 1; padding: 10px; border-radius: 6px; border: 1px solid var(--border);
      background: var(--bg); color: var(--text);
    }
    select, button {
      padding: 10px 12px; border-radius: 6px; border: 1px solid var(--border);
      background: var(--panel); color: var(--text); cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    button:hover, select:hover { background: var(--accent); color: #fff; }

    /* LAYOUT */
    #layout { flex: 1; display: flex; overflow: hidden; min-height: 0; }
    #sidebar {
      width: 300px; background: var(--panel); border-right: 1px solid var(--border);
      display: flex; flex-direction: column; min-width: 220px;
    }
    #search {
      margin: 12px; padding: 10px; border-radius: 6px; border: 1px solid var(--border);
      background: var(--bg); color: var(--text);
    }
    #gameList {
      flex: 1; overflow-y: auto; padding: 8px 8px 16px;
    }
    .game-item {
      display: flex; align-items: center; justify-content: space-between;
      gap: 8px; padding: 10px; border-radius: 8px; cursor: pointer;
      transition: background 0.2s;
    }
    .game-item:hover { background: var(--accent); color: #fff; }
    .game-title {
      display: flex; align-items: center; gap: 10px; overflow: hidden;
    }
    .game-title .icon { font-size: 20px; flex-shrink: 0; }
    .game-title .text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .remove-btn {
      border: 1px solid var(--border); border-radius: 6px; background: transparent;
      color: var(--text); padding: 4px 8px; cursor: pointer;
    }
    .remove-btn:hover { background: var(--danger); color: #fff; }

    #viewer {
      flex: 1; background: #000; display: flex; align-items: center; justify-content: center;
      position: relative; min-width: 0;
    }
    #viewer iframe, #viewer .audio-ui {
      width: 92%; height: 92%; border: none; border-radius: 10px; overflow: hidden;
      box-shadow: 0 0 24px rgba(0,0,0,0.6);
      background: #000;
    }
    #emptyState { color: var(--muted); font-size: 14px; }

    .audio-ui {
      background: #111; padding: 16px; color: #fff;
      display: flex; flex-direction: column; gap: 12px;
    }
    .controls { display: flex; gap: 12px; align-items: center; }
    .controls input[type="range"] { flex: 1; }

    /* Hidden inputs (must be in DOM for programmatic click) */
    #hiddenHtmlInput, #hiddenAudioInput { position: absolute; left: -9999px; top: -9999px; }

    /* Overlay fullscreen (fills app area) */
    body.viewer-fill #viewer {
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    body.viewer-fill #viewer iframe,
    body.viewer-fill #viewer .audio-ui {
      width: 100vw;
      height: 100vh;
      border-radius: 0;
      box-shadow: none;
    }

    /* Native fullscreen (browser Fullscreen API) */
    #viewer:fullscreen iframe,
    #viewer:fullscreen .audio-ui {
      width: 100vw;
      height: 100vh;
      border-radius: 0;
      box-shadow: none;
    }
  </style>
</head>
<body>

  <div id="topbar">
    <select id="addDropdown" aria-label="Add Non-Launcher Game">
      <option selected disabled>➕ Add Non‑Launcher Game</option>
      <option value="html">Import HTML</option>
      <option value="audio">Import Audio</option>
    </select>
    <input id="urlInput" type="text" placeholder="Enter URL and press Add or Enter" />
    <button id="addUrlBtn">Add</button>
    <button id="toggleFillBtn">Fullscreen</button>
    <button id="toggleNativeFSBtn">Browser Fullscreen</button>
    <button id="closeGameBtn">Close</button>
  </div>

  <div id="layout">
    <div id="sidebar">
      <input id="search" type="text" placeholder="Search..." />
      <div id="gameList"></div>
    </div>
    <div id="viewer"><div id="emptyState">Select a game to launch</div></div>
  </div>

  <!-- Hidden file inputs (wired to dropdown) -->
  <input id="hiddenHtmlInput" type="file" accept=".html,.htm,text/html" multiple />
  <input id="hiddenAudioInput" type="file" accept="audio/*" multiple />
<script>
document.addEventListener('DOMContentLoaded', () => {
  // Elements
  const urlInput = document.getElementById('urlInput');
  const addUrlBtn = document.getElementById('addUrlBtn');
  const addDropdown = document.getElementById('addDropdown');
  const htmlInput = document.getElementById('hiddenHtmlInput');
  const audioInput = document.getElementById('hiddenAudioInput');
  const search = document.getElementById('search');
  const gameList = document.getElementById('gameList');
  const viewer = document.getElementById('viewer');
  const toggleFillBtn = document.getElementById('toggleFillBtn');
  const toggleNativeFSBtn = document.getElementById('toggleNativeFSBtn');
  const closeGameBtn = document.getElementById('closeGameBtn');

  // Persistence: ONLY URLs saved
  let saved = [];
  try {
    const raw = localStorage.getItem('knightIS');
    const parsed = raw ? JSON.parse(raw) : [];
    saved = Array.isArray(parsed) ? parsed.filter(it => it && it.type === 'url') : [];
  } catch { saved = []; }

  // Ephemeral in-memory items (html/audio)
  const ephemeral = [];

  function save() {
    try { localStorage.setItem('knightIS', JSON.stringify(saved)); } catch {}
  }

  function normalizeUrl(u) {
    if (!u) return '';
    const trimmed = u.trim();
    if (/^(https?:|blob:|data:)/i.test(trimmed)) return trimmed;
    return 'https://' + trimmed;
  }

  function getAllItems() {
    return [...ephemeral, ...saved];
  }

  function render() {
    gameList.innerHTML = '';
    const query = search.value.trim().toLowerCase();
    getAllItems().forEach(item => {
      if (query && !item.title.toLowerCase().includes(query)) return;

      const row = document.createElement('div');
      row.className = 'game-item';

      const title = document.createElement('div');
      title.className = 'game-title';
      const icon = document.createElement('span');
      icon.className = 'icon';
      icon.textContent = item.type === 'audio' ? '🎵' : '📄';
      const text = document.createElement('span');
      text.className = 'text';
      text.textContent = item.title;

      title.appendChild(icon);
      title.appendChild(text);

      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-btn';
      removeBtn.textContent = '✖';

      removeBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        if (item.type === 'url') {
          const idx = saved.indexOf(item);
          if (idx >= 0) { saved.splice(idx, 1); save(); }
        } else {
          const idx = ephemeral.indexOf(item);
          if (idx >= 0) { ephemeral.splice(idx, 1); }
        }
        render();
        showEmptyState();
        updateFillLabel();
        updateNativeFSLabel();
      });

      row.appendChild(title);
      row.appendChild(removeBtn);
      row.addEventListener('click', () => launch(item));
      gameList.appendChild(row);
    });

    if (!gameList.children.length) {
      const empty = document.createElement('div');
      empty.style.color = 'var(--muted)';
      empty.style.padding = '12px';
      empty.textContent = 'No items yet. Use Add Non‑Launcher Game or Add a URL.';
      gameList.appendChild(empty);
    }
  }

  function showEmptyState() {
    viewer.innerHTML = '<div id="emptyState" style="color: var(--muted);">Select a game to launch</div>';
  }

  function launch(item) {
    viewer.innerHTML = '';
    if (item.type === 'url' || item.type === 'html') {
      const frame = document.createElement('iframe');
      frame.src = item.src;
      frame.allow = 'autoplay; clipboard-read; clipboard-write';
      frame.referrerPolicy = 'no-referrer-when-downgrade';
      viewer.appendChild(frame);
    } else if (item.type === 'audio') {
      const wrap = document.createElement('div');
      wrap.className = 'audio-ui';
      const h = document.createElement('h2');
      h.textContent = item.title;
      const audio = document.createElement('audio');
      audio.src = item.src;
      audio.controls = false;

      const controls = document.createElement('div');
      controls.className = 'controls';
      const playBtn = document.createElement('button');
      playBtn.textContent = '▶️';
      playBtn.addEventListener('click', () => audio.play().catch(() => {}));
      const pauseBtn = document.createElement('button');
      pauseBtn.textContent = '⏸️';
      pauseBtn.addEventListener('click', () => audio.pause());
      const volume = document.createElement('input');
      volume.type = 'range'; volume.min = 0; volume.max = 1; volume.step = 0.01;
      volume.value = audio.volume;
      volume.addEventListener('input', () => audio.volume = Number(volume.value));
      const seek = document.createElement('input');
      seek.type = 'range'; seek.min = 0; seek.max = 100; seek.step = 0.1; seek.value = 0;
      seek.addEventListener('input', () => {
        if (!isNaN(audio.duration)) {
          audio.currentTime = (Number(seek.value) / 100) * audio.duration;
        }
      });
      audio.addEventListener('timeupdate', () => {
        if (!isNaN(audio.duration) && audio.duration > 0) {
          seek.value = (audio.currentTime / audio.duration) * 100;
        }
      });

      controls.appendChild(playBtn);
      controls.appendChild(pauseBtn);
      controls.appendChild(volume);
      controls.appendChild(seek);
      wrap.appendChild(h);
      wrap.appendChild(controls);
      wrap.appendChild(audio);
      viewer.appendChild(wrap);
    }
    updateFillLabel();
    updateNativeFSLabel();
  }

  // Add URL (button + Enter key)
  addUrlBtn.addEventListener('click', () => {
    const url = normalizeUrl(urlInput.value);
    if (!url) return;
    const item = { title: url, type: 'url', src: url };
    saved.push(item);
    save();
    render();
    launch(item);
    urlInput.value = '';
  });
  urlInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') addUrlBtn.click();
  });

  // Dropdown import (programmatically triggers hidden inputs)
  addDropdown.addEventListener('change', () => {
    const v = addDropdown.value;
    if (v === 'html') {
      htmlInput.value = '';
      htmlInput.click();
    } else if (v === 'audio') {
      audioInput.value = '';
      audioInput.click();
    }
    addDropdown.selectedIndex = 0;
  });

  // HTML import handler (ephemeral)
  htmlInput.addEventListener('change', (e) => {
    const files = Array.from(e.target.files || []);
    if (!files.length) return;
    files.forEach(file => {
      const blobUrl = URL.createObjectURL(file);
      const title = file.name || 'HTML File';
      ephemeral.push({ title, type: 'html', src: blobUrl });
    });
    render();
  });

  // Audio import handler (ephemeral)
  audioInput.addEventListener('change', (e) => {
    const files = Array.from(e.target.files || []);
    if (!files.length) return;
    files.forEach(file => {
      const blobUrl = URL.createObjectURL(file);
      const title = file.name || 'Audio';
      ephemeral.push({ title, type: 'audio', src: blobUrl });
    });
    render();
  });

  // Live search
  search.addEventListener('input', render);

  // Overlay fullscreen toggle (fills app area)
  function updateFillLabel() {
    const on = document.body.classList.contains('viewer-fill');
    toggleFillBtn.textContent = on ? 'Exit Fullscreen' : 'Fullscreen';
  }
  toggleFillBtn.addEventListener('click', () => {
    document.body.classList.toggle('viewer-fill');
    updateFillLabel();
  });
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && document.body.classList.contains('viewer-fill')) {
      document.body.classList.remove('viewer-fill');
      updateFillLabel();
    }
  });

  // Native fullscreen (browser Fullscreen API)
  function isFullscreen() { return document.fullscreenElement != null; }
  async function enterFullscreen(el) { try { await el.requestFullscreen(); } catch {} }
  async function exitFullscreen() { try { await document.exitFullscreen(); } catch {} }
  function updateNativeFSLabel() {
    toggleNativeFSBtn.textContent = isFullscreen() ? 'Exit Browser Fullscreen' : 'Browser Fullscreen';
  }
  toggleNativeFSBtn.addEventListener('click', async () => {
    const target = viewer;
    if (!isFullscreen()) { await enterFullscreen(target); }
    else { await exitFullscreen(); }
    updateNativeFSLabel();
  });
  document.addEventListener('fullscreenchange', updateNativeFSLabel);

  // Close current game button
  function closeCurrentGame() {
    showEmptyState();
    if (document.body.classList.contains('viewer-fill')) {
      document.body.classList.remove('viewer-fill');
    }
    if (document.fullscreenElement) {
      try { document.exitFullscreen(); } catch {}
    }
    updateFillLabel();
    updateNativeFSLabel();
  }
  closeGameBtn.addEventListener('click', closeCurrentGame);

  // Initial paint
  render();
  updateFillLabel();
  updateNativeFSLabel();
});
</script>
</body>
</html>
















